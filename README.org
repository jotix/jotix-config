* Jotix's NixOS instalation guide

** Requirements

To proced with the installation make the following partitions:

|----------------+------------|
| partition type | label      |
|----------------+------------|
| FAT32 (ef00)   | NIXOS-BOOT |
| btrfs          | NixOS      |
|----------------+------------|

To list the disk availables type:

#+begin_src sh
sudo parted -l
#+end_src

Prepare the installation disk:

#+begin_src sh
DISKNAME=/dev/XXXXXX

sudo parted $DISKNAME mklabel gpt
sudo parted --align optimal -- $DISKNAME mkpart NIXOS-BOOT 1MiB 1GiB
sudo parted --align optimal -- $DISKNAME mkpart NixOS btrfs 1GiB -1

sudo parted $DISKNAME set 1 esp on

sudo mkfs.vfat -F32 -n NIXOS-BOOT /dev/disk/by-partlabel/NIXOS-BOOT
sudo mkfs.btrfs -L NixOS /dev/disk/by-partlabel/NixOS -f
#+end_src

** Prepare the subvolumes disk layout

Create the FileSystems & mount the partition/subvolumen in the right place.
Execute the followind commands:

#+begin_src sh
# Create the subvolumes
sudo mount LABEL=NixOS /mnt
sudo btrfs subvolume create /mnt/@
sudo btrfs subvolume create /mnt/@nix
sudo btrfs subvolume create /mnt/@home
sudo umount -R /mnt

# make the directories
sudo mount LABEL=NixOS /mnt -osubvol=/@
sudo mkdir -p /mnt/home
sudo mkdir -p /mnt/nix
sudo mkdir -p /mnt/boot

# mount all in the right place
sudo mount LABEL=NixOS /mnt/home -osubvol=/@home
sudo mount LABEL=NixOS /mnt/nix -osubvol=/@nix
sudo mount LABEL=NIXOS-BOOT /mnt/boot
#+end_src

** clone this repository

#+begin_src sh
git clone https://github.com/jotix/nixos-config.git
cd nixos-config
#+end_src

** Optional: Update flake

If you like, you can update the flake by run the following command:

#+begin_src sh
nix flake update --extra-experimental-features 'nix-command flakes'
#+end_src

** Install the new system

To install the new system run the following command:

#+begin_src sh
sudo nixos-install --flake .#[hostname]
#+end_src

** Optional: copy nixos-config folder to the new installation

If changes are made in any file of this repo, copy it to the new installation if you don't want to loose the changes.

#+begin_src sh
sudo cp -rv ~/nixos-config /mnt/home/jotix/
#+end_src

** set jotix's password

Set the password for jotix user in the new installation:

#+begin_src sh
sudo nixos-enter --command 'passwd jotix'
#+end_src

** Final Steps

Unmount the partitions, reboot, and enjoy the new system...


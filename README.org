* Jotix's NixOS instalation guide

** List availables disks
To list the disk availables type:

#+begin_src sh
sudo parted -l
#+end_src

** Run the pre-install script
    
REPLACE THE DISKNAME & HOSTNAME IN THE SCRIPT

#+begin_src sh
# replace the diskname
DISKNAME=/dev/XXXXXX
HOSTNAME=xxx-nixos

# make a new GPT partition table
sudo parted $DISKNAME mklabel gpt

# make EFI & btrfs partitions
sudo parted --align optimal -- $DISKNAME mkpart NIXOS-BOOT fat32 1MiB 1GiB
sudo parted --align optimal -- $DISKNAME mkpart NixOS btrfs 1GiB -1

# set esp flag in EFI partition
sudo parted $DISKNAME set 1 esp on

# make the filesystems
sudo mkfs.vfat -F32 -n NIXOS-BOOT /dev/disk/by-partlabel/NIXOS-BOOT
sudo mkfs.btrfs -L NixOS /dev/disk/by-partlabel/NixOS -f

# mount the disk & create the subvolumes
sudo mount LABEL=NixOS /mnt
sudo btrfs subvolume create /mnt/@
sudo btrfs subvolume create /mnt/@nix
sudo btrfs subvolume create /mnt/@home
sudo umount -R /mnt

# make the directories
sudo mount LABEL=NixOS /mnt -osubvol=/@
sudo mkdir -p /mnt/home
sudo mkdir -p /mnt/nix
sudo mkdir -p /mnt/boot

# mount all in the right place
sudo mount LABEL=NixOS /mnt/home -osubvol=/@home
sudo mount LABEL=NixOS /mnt/nix -osubvol=/@nix
sudo mount LABEL=NIXOS-BOOT /mnt/boot

# clone this repository
git clone https://github.com/jotix/nixos-config.git

# enter in the repository folder
cd nixos-config

# Optional: Update flake
# If you like, you can update the flake by run the following command:
#nix flake update --extra-experimental-features 'nix-command flakes'

# Install the new system
sudo nixos-install --flake .#$HOSTNAME

# Optional: copy nixos-config folder to the new installation
# If changes are made in any file of this repo, copy it to the new installation if you don't want to loose the changes.
#git remote remove origin
#git remote add origin git@github.com:jotix/nixos-config.git
#sudo cp -rv ~/nixos-config /mnt/home/jotix/

# set jotix's password
sudo nixos-enter --command 'echo "ENTER JOTIX PASSWORD" && passwd jotix'

# set filofem password
[[ if $HOSTNAME == "ffm-nixos" ]] && sudo nixos-enter --command 'echo "ENTER FILOFEM PASSWORD" && passwd filofem'
#+end_src

** Final Steps

Unmount the partitions, reboot, and enjoy the new system...

